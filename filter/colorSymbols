#!/bin/bash
export COLOR_CONTEXT=$GREEN
export COLOR_PROJECT=$RED
export COLOR_DATE=$LIGHT_GREEN
if [ "$TODOTXT_PLAIN" -eq "0" ]; then
awk --re-interval '
function highlight(colorVar,      color) {
    color = ENVIRON[colorVar]
    gsub(/\\+033/, "\033", color)
    return color
}
function linehl(      hl) {
    if (match($0, /[0-9]+ /) > 1) {
        return substr($0, 1, RSTART - 1)
    } else {
        return highlight("DEFAULT")
    }
}
{
    color = linehl()
    $0 = gensub(/ (@[^ ]*)/, " " highlight("COLOR_CONTEXT") "\\1" color, "g")
    $0 = gensub(/ (\+[^ ]*)/, " " highlight("COLOR_PROJECT") "\\1" color, "g")
    $0 = gensub(/ ([0-9]{4}-[0-9]{2}-[0-9]{2}) /, " " highlight("COLOR_DATE") "\\1" color " ", "")
    print
}
'
else
cat
fi
